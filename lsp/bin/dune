(include_subdirs unqualified)

; get rid of this gross hack once dune has proper crunch support

(rule
 (with-stdout-to
  metamodel_lsp.ml
  (progn
   (echo "let t () = Metamodel.t @@ Yojson.Safe.from_string {json|")
   (echo "%{read:metaModel.json}")
   (echo "|json}"))))

(test
 (name test_metamodel)
 (modules test_metamodel)
 (libraries stdune yojson lsp_gen)
 (deps metaModel.json)
 (action
  (run ./test_metamodel.exe %{deps})))

(library
 (name lsp_gen)
 (instrumentation
  (backend bisect_ppx))
 (modules :standard \ test_metamodel)
 (libraries stdune dyn pp yojson))
